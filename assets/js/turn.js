!function(t){"use strict";var e,a="",i=Math.PI,r=i/2,s="ontouchstart"in window,n=s?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},o={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br"]},p=["single","double"],l={page:1,gradients:!0,duration:1500,acceleration:!0,display:"double",when:null},g={folding:null,corners:"forward",cornerSize:100,gradients:!0,duration:600,acceleration:!0},h={0:{top:0,left:0,right:"auto",bottom:"auto"},1:{top:0,right:0,left:"auto",bottom:"auto"}},d=function(t,e,a,i){return{css:{position:"absolute",top:t,left:e,overflow:i||"hidden","z-index":a||"auto"}}},f=function(t,e,a,i,r){var s=1-r,n=s*s*s,o=r*r*r;return c(Math.round(n*t.x+3*r*s*s*e.x+3*r*r*s*a.x+o*i.x),Math.round(n*t.y+3*r*s*s*e.y+3*r*r*s*a.y+o*i.y))},c=function(t,e){return{x:t,y:e}},u=function(t,a,i){return e&&i?" translate3d("+t+"px,"+a+"px, 0px) ":" translate("+t+"px, "+a+"px) "},$=function(t){return" rotate("+t+"deg) "},v=function(t,e){return Object.prototype.hasOwnProperty.call(e,t)},_=function(){for(var t=["Moz","Webkit","Khtml","O","ms"],e=t.length,a="";e--;)t[e]+"Transform" in document.body.style&&(a="-"+t[e].toLowerCase()+"-");return a},b=function(t,e,i,r,s){var n,o=[];if("-webkit-"==a){for(n=0;n<s;n++)o.push("color-stop("+r[n][0]+", "+r[n][1]+")");t.css({"background-image":"-webkit-gradient(linear, "+e.x+"% "+e.y+"%,  "+i.x+"% "+i.y+"%, "+o.join(",")+" )"})}else{e={x:e.x/100*t.width(),y:e.y/100*t.height()};var p=(i={x:i.x/100*t.width(),y:i.y/100*t.height()}).x-e.x,l=i.y-e.y,g=Math.atan2(l,p),h=g-Math.PI/2,d=Math.abs(t.width()*Math.sin(h))+Math.abs(t.height()*Math.cos(h)),f=Math.sqrt(l*l+p*p),u=c(i.x<e.x?t.width():0,i.y<e.y?t.height():0),$=Math.tan(g),v=-1/$,_=(v*u.x-u.y-$*e.x+e.y)/(v-$),b={x:_,y:v*_-v*u.x+u.y},w=Math.sqrt(Math.pow(b.x-e.x,2)+Math.pow(b.y-e.y,2));for(n=0;n<s;n++)o.push(" "+r[n][1]+" "+(w+f*r[n][0])*100/d+"%");t.css({"background-image":a+"linear-gradient("+-g+"rad,"+o.join(",")+")"})}},w={init:function(i){void 0===e&&(e="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,a=_());var r,p=this.data(),g=this.children();if(i=t.extend({width:this.width(),height:this.height()},l,i),p.opts=i,p.pageObjs={},p.pages={},p.pageWrap={},p.pagePlace={},p.pageMv=[],p.totalPages=i.pages||0,i.when)for(r in i.when)v(r,i.when)&&this.bind(r,i.when[r]);for(this.css({position:"relative",width:i.width,height:i.height}),this.turn("display",i.display),e&&!s&&i.acceleration&&this.transform(u(0,0,!0)),r=0;r<g.length;r++)this.turn("addPage",g[r],r+1);return this.turn("page",i.page),o=t.extend({},o,i.corners),t(this).bind(n.start,function(t){for(var e in p.pages)if(v(e,p.pages)&&!1===x._eventStart.call(p.pages[e],t))return!1}),t(document).bind(n.move,function(t){for(var e in p.pages)v(e,p.pages)&&x._eventMove.call(p.pages[e],t)}).bind(n.end,function(t){for(var e in p.pages)v(e,p.pages)&&x._eventEnd.call(p.pages[e],t)}),p.done=!0,this},addPage:function(e,a){var i=!1,r=this.data(),s=r.totalPages+1;if(a){if(a==s)a=s,i=!0;else if(a>s)throw Error('It is impossible to add the page "'+a+'", the maximum value is: "'+s+'"')}else a=s,i=!0;return a>=1&&a<=s&&(r.done&&this.turn("stop"),a in r.pageObjs&&w._movePages.call(this,a,1),i&&(r.totalPages=s),r.pageObjs[a]=t(e).addClass("turn-page p"+a),w._addPage.call(this,a),r.done&&this.turn("update"),w._removeFromDOM.call(this)),this},_addPage:function(e){var a=this.data(),i=a.pageObjs[e];if(i){if(w._necessPage.call(this,e)){if(!a.pageWrap[e]){var r="double"==a.display?this.width()/2:this.width(),s=this.height();i.css({width:r,height:s}),a.pagePlace[e]=e,a.pageWrap[e]=t("<div/>",{class:"turn-page-wrapper",page:e,css:{position:"absolute",overflow:"hidden",width:r,height:s}}).css(h["double"==a.display?e%2:0]),this.append(a.pageWrap[e]),a.pageWrap[e].prepend(a.pageObjs[e])}e&&1!=w._setPageLoc.call(this,e)||w._makeFlip.call(this,e)}else a.pagePlace[e]=0,a.pageObjs[e]&&a.pageObjs[e].remove()}},hasPage:function(t){return t in this.data().pageObjs},_makeFlip:function(t){var e=this.data();if(!e.pages[t]&&e.pagePlace[t]==t){var a="single"==e.display,i=t%2;e.pages[t]=e.pageObjs[t].css({width:a?this.width():this.width()/2,height:this.height()}).flip({page:t,next:a&&t===e.totalPages?t-1:i||a?t+1:t-1,turn:this,duration:e.opts.duration,acceleration:e.opts.acceleration,corners:a?"all":i?"forward":"backward",backGradient:e.opts.gradients,frontGradient:e.opts.gradients}).flip("disable",e.disabled).bind("pressed",w._pressed).bind("released",w._released).bind("start",w._start).bind("end",w._end).bind("flip",w._flip)}return e.pages[t]},_makeRange:function(){this.data();var t,e=this.turn("range");for(t=e[0];t<=e[1];t++)w._addPage.call(this,t)},range:function(t){var e,a,i,r=this.data();t=t||r.tpage||r.page;var s=w._view.call(this,t);if(t<1||t>r.totalPages)throw Error('"'+t+'" is not a page for range');return s[1]=s[1]||s[0],s[0]>=1&&s[1]<=r.totalPages?(e=Math.floor(2),r.totalPages-s[1]>s[0]?(a=Math.min(s[0]-1,e),i=2*e-a):(i=Math.min(r.totalPages-s[1],e),a=2*e-i)):(a=5,i=5),[Math.max(1,s[0]-a),Math.min(r.totalPages,s[1]+i),]},_necessPage:function(t){if(0===t)return!0;var e=this.turn("range");return t>=e[0]&&t<=e[1]},_removeFromDOM:function(){var t,e=this.data();for(t in e.pageWrap)v(t,e.pageWrap)&&!w._necessPage.call(this,t)&&w._removePageFromDOM.call(this,t)},_removePageFromDOM:function(t){var e=this.data();if(e.pages[t]){var a=e.pages[t].data();a.f&&a.f.fwrapper&&a.f.fwrapper.remove(),e.pages[t].remove(),delete e.pages[t]}e.pageObjs[t]&&e.pageObjs[t].remove(),e.pageWrap[t]&&(e.pageWrap[t].remove(),delete e.pageWrap[t]),delete e.pagePlace[t]},removePage:function(t){var e=this.data();return e.pageObjs[t]&&(this.turn("stop"),w._removePageFromDOM.call(this,t),delete e.pageObjs[t],w._movePages.call(this,t,-1),e.totalPages=e.totalPages-1,w._makeRange.call(this),e.page>e.totalPages&&this.turn("page",e.totalPages)),this},_movePages:function(t,e){var a,i=this.data(),r="single"==i.display,s=function(t){var a=t+e,s=a%2;i.pageObjs[t]&&(i.pageObjs[a]=i.pageObjs[t].removeClass("page"+t).addClass("page"+a)),i.pagePlace[t]&&i.pageWrap[t]&&(i.pagePlace[a]=a,i.pageWrap[a]=i.pageWrap[t].css(h[r?0:s]).attr("page",a),i.pages[t]&&(i.pages[a]=i.pages[t].flip("options",{page:a,next:r||s?a+1:a-1,corners:r?"all":s?"forward":"backward"})),e&&(delete i.pages[t],delete i.pagePlace[t],delete i.pageObjs[t],delete i.pageWrap[t],delete i.pageObjs[t]))};if(e>0)for(a=i.totalPages;a>=t;a--)s(a);else for(a=t;a<=i.totalPages;a++)s(a)},display:function(e){var a=this.data(),i=a.display;if(!e)return i;if(-1==t.inArray(e,p))throw Error('"'+e+'" is not a value for display');if("single"==e?a.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),a.pageObjs[0]=t("<div />",{class:"turn-page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)):a.pageObjs[0]&&(this.turn("stop").css({overflow:""}),a.pageObjs[0].remove(),delete a.pageObjs[0]),a.display=e,i){var r=this.turn("size");w._movePages.call(this,1,0),this.turn("size",r.width,r.height).turn("update")}return this},animating:function(){return this.data().pageMv.length>0},disable:function(e){var a,i=this.data(),r=this.turn("view");for(a in i.disabled=void 0===e||!0===e,i.pages)v(a,i.pages)&&i.pages[a].flip("disable",!!e&&t.inArray(a,r));return this},size:function(t,e){if(!t||!e)return{width:this.width(),height:this.height()};var a,i=this.data(),r="double"==i.display?t/2:t;for(a in this.css({width:t,height:e}),i.pageObjs[0]&&i.pageObjs[0].css({width:r,height:e}),i.pageWrap)v(a,i.pageWrap)&&(i.pageObjs[a].css({width:r,height:e}),i.pageWrap[a].css({width:r,height:e}),i.pages[a]&&i.pages[a].css({width:r,height:e}));return this.turn("resize"),this},resize:function(){var t,e=this.data();for(e.pages[0]&&(e.pageWrap[0].css({left:-this.width()}),e.pages[0].flip("resize",!0)),t=1;t<=e.totalPages;t++)e.pages[t]&&e.pages[t].flip("resize",!0)},_removeMv:function(t){var e,a=this.data();for(e=0;e<a.pageMv.length;e++)if(a.pageMv[e]==t)return a.pageMv.splice(e,1),!0;return!1},_addMv:function(t){var e=this.data();w._removeMv.call(this,t),e.pageMv.push(t)},_view:function(t){var e=this.data();return(t=t||e.page,"double"==e.display)?t%2?[t-1,t]:[t,t+1]:[t]},view:function(t){var e=this.data(),a=w._view.call(this,t);return"double"==e.display?[a[0]>0?a[0]:0,a[1]<=e.totalPages?a[1]:0,]:[a[0]>0&&a[0]<=e.totalPages?a[0]:0]},stop:function(t){var e,a,i=this.data(),r=i.pageMv;for(e in i.pageMv=[],i.tpage&&(i.page=i.tpage,delete i.tpage),r)v(e,r)&&(a=i.pages[r[e]].data().f.opts,x._moveFoldingPage.call(i.pages[r[e]],null),i.pages[r[e]].flip("hideFoldedPage"),i.pagePlace[a.next]=a.next,a.force&&(a.next=a.page%2==0?a.page-1:a.page+1,delete a.force));return this.turn("update"),this},pages:function(t){var e=this.data();if(!t)return e.totalPages;if(t<e.totalPages){for(var a=t+1;a<=e.totalPages;a++)this.turn("removePage",a);this.turn("page")>t&&this.turn("page",t)}return e.totalPages=t,this},_fitPage:function(e,a){var i=this.data(),r=this.turn("view",e);i.page!=e&&(this.trigger("turning",[e,r]),-1!=t.inArray(1,r)&&this.trigger("first"),-1!=t.inArray(i.totalPages,r)&&this.trigger("last")),i.pageObjs[e]&&(i.tpage=e,this.turn("stop",a),w._removeFromDOM.call(this),w._makeRange.call(this),this.trigger("turned",[e,r]))},_turnPage:function(e){var a,i,r=this.data(),s=this.turn("view"),n=this.turn("view",e);if(r.page!=e&&(this.trigger("turning",[e,n]),-1!=t.inArray(1,n)&&this.trigger("first"),-1!=t.inArray(r.totalPages,n)&&this.trigger("last")),r.pageObjs[e]&&(r.tpage=e,this.turn("stop"),w._makeRange.call(this),"single"==r.display?(a=s[0],i=n[0]):s[1]&&e>s[1]?(a=s[1],i=n[0]):s[0]&&e<s[0]&&(a=s[0],i=n[1]),r.pages[a])){var o=r.pages[a].data().f.opts;r.tpage=i,o.next!=i&&(o.next=i,r.pagePlace[i]=o.page,o.force=!0),"single"==r.display?r.pages[a].flip("turnPage",n[0]>s[0]?"br":"bl"):r.pages[a].flip("turnPage")}},page:function(e){e=parseInt(e,10);var a=this.data();return e>0&&e<=a.totalPages?(a.done&&-1==t.inArray(e,this.turn("view"))?w._turnPage.call(this,e):w._fitPage.call(this,e),this):a.page},next:function(){var t=this.data();return this.turn("page",w._view.call(this,t.page).pop()+1)},previous:function(){var t=this.data();return this.turn("page",w._view.call(this,t.page).shift()-1)},_addMotionPage:function(){var e=t(this).data().f.opts,a=e.turn,i=a.data();e.pageMv=e.page,w._addMv.call(a,e.pageMv),i.pagePlace[e.next]=e.page,a.turn("update")},_start:function(e,a,i){var r=a.turn.data(),s=t.Event("start");if(e.stopPropagation(),a.turn.trigger(s,[a,i]),s.isDefaultPrevented()){e.preventDefault();return}if("single"==r.display){var n="l"==i.charAt(1);1==a.page&&n||a.page==r.totalPages&&!n?e.preventDefault():n?(a.next=a.next<a.page?a.next:a.page-1,a.force=!0):a.next=a.next>a.page?a.next:a.page+1}w._addMotionPage.call(this)},_end:function(e,a){var i=t(this).data().f.opts,r=i.turn,s=r.data();e.stopPropagation(),a||s.tpage?(s.tpage==i.next||s.tpage==i.page)&&(delete s.tpage,w._fitPage.call(r,s.tpage||i.next,!0)):(w._removeMv.call(r,i.pageMv),r.turn("update"))},_pressed:function(){var e,a=t(this).data().f,i=a.opts.turn.data().pages;for(e in i)e!=a.opts.page&&i[e].flip("disable",!0);return a.time=new Date().getTime()},_released:function(e,a){var i=t(this),r=i.data().f;e.stopPropagation(),(new Date().getTime()-r.time<200||a.x<0||a.x>t(this).width())&&(e.preventDefault(),r.opts.turn.data().tpage=r.opts.next,r.opts.turn.turn("update"),t(i).flip("turnPage"))},_flip:function(){var e=t(this).data().f.opts;e.turn.trigger("turn",[e.next])},calculateZ:function(t){var e,a,i,r,s,n=this,o=this.data(),p=this.turn("view"),l=p[0]||p[1],g={pageZ:{},partZ:{},pageV:{}},h=function(t){var e=n.turn("view",t);e[0]&&(g.pageV[e[0]]=!0),e[1]&&(g.pageV[e[1]]=!0)};for(e=0;e<t.length;e++)a=t[e],i=o.pages[a].data().f.opts.next,r=o.pagePlace[a],h(a),h(i),s=o.pagePlace[i]==i?i:a,g.pageZ[s]=o.totalPages-Math.abs(l-s),g.partZ[r]=2*o.totalPages+Math.abs(l-s);return g},update:function(){var t,e=this.data();if(e.pageMv.length&&0!==e.pageMv[0]){var a,i=this.turn("calculateZ",e.pageMv),r=this.turn("view",e.tpage);for(t in e.pagePlace[r[0]]==r[0]?a=r[0]:e.pagePlace[r[1]]==r[1]&&(a=r[1]),e.pageWrap)v(t,e.pageWrap)&&(e.pageWrap[t].css({display:i.pageV[t]?"":"none","z-index":i.pageZ[t]||0}),e.pages[t]&&(e.pages[t].flip("z",i.partZ[t]||null),i.pageV[t]&&e.pages[t].flip("resize"),e.tpage&&e.pages[t].flip("disable",!0)))}else for(t in e.pageWrap)if(v(t,e.pageWrap)){var s=w._setPageLoc.call(this,t);e.pages[t]&&e.pages[t].flip("disable",e.disabled||1!=s).flip("z",null)}},_setPageLoc:function(t){var e=this.data(),a=this.turn("view");return t==a[0]||t==a[1]?(e.pageWrap[t].css({"z-index":e.totalPages,display:""}),1):"single"==e.display&&t==a[0]+1||"double"==e.display&&t==a[0]-2||t==a[1]+2?(e.pageWrap[t].css({"z-index":e.totalPages-1,display:""}),2):(e.pageWrap[t].css({"z-index":0,display:"none"}),0)}},x={init:function(t){return t.gradients&&(t.frontGradient=!0,t.backGradient=!0),this.data({f:{}}),this.flip("options",t),x._addPageWrapper.call(this),this},setData:function(e){var a=this.data();return a.f=t.extend(a.f,e),this},options:function(e){var a=this.data().f;return e?(x.setData.call(this,{opts:t.extend({},a.opts||g,e)}),this):a.opts},z:function(t){var e=this.data().f;return e.opts["z-index"]=t,e.fwrapper.css({"z-index":t||parseInt(e.parent.css("z-index"),10)||0}),this},_cAllowed:function(){return o[this.data().f.opts.corners]||this.data().f.opts.corners},_cornerActivated:function(e){if(void 0===e.originalEvent)return!1;e=s?e.originalEvent.touches:[e];var a=this.data().f,i=a.parent.offset(),r=this.width(),n=this.height(),o={x:Math.max(0,e[0].pageX-i.left),y:Math.max(0,e[0].pageY-i.top)},p=a.opts.cornerSize,l=x._cAllowed.call(this);if(o.x<=0||o.y<=0||o.x>=r||o.y>=n)return!1;if(o.y<p)o.corner="t";else{if(!(o.y>=n-p))return!1;o.corner="b"}if(o.x<=p)o.corner+="l";else{if(!(o.x>=r-p))return!1;o.corner+="r"}return -1!=t.inArray(o.corner,l)&&o},_c:function(t,e){return({tl:c(e=e||0,e),tr:c(this.width()-e,e),bl:c(e,this.height()-e),br:c(this.width()-e,this.height()-e)})[t]},_c2:function(t){return({tl:c(2*this.width(),0),tr:c(-this.width(),0),bl:c(2*this.width(),this.height()),br:c(-this.width(),this.height())})[t]},_foldingPage:function(t){var e=this.data().f.opts;if(e.folding)return e.folding;if(e.turn){var a=e.turn.data();return"single"==a.display?a.pageObjs[e.next]?a.pageObjs[0]:null:a.pageObjs[e.next]}},_backGradient:function(){var e=this.data().f,a=e.opts.turn,i=e.opts.backGradient&&(!a||"single"==a.data().display||2!=e.opts.page&&e.opts.page!=a.data().totalPages-1);return i&&!e.bshadow&&(e.bshadow=t("<div/>",d(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(e.parent)),i},resize:function(t){var e=this.data().f,a=this.width(),i=this.height(),r=Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(i,2)));t&&(e.wrapper.css({width:r,height:r}),e.fwrapper.css({width:r,height:r}).children(":first-child").css({width:a,height:i}),e.fpage.css({width:i,height:a}),e.opts.frontGradient&&e.ashadow.css({width:i,height:a}),x._backGradient.call(this)&&e.bshadow.css({width:a,height:i})),e.parent.is(":visible")&&(e.fwrapper.css({top:e.parent.offset().top,left:e.parent.offset().left}),e.opts.turn&&e.fparent.css({top:-e.opts.turn.offset().top,left:-e.opts.turn.offset().left})),this.flip("z",e.opts["z-index"])},_addPageWrapper:function(){var e=this.data().f,a=this.parent();if(!e.wrapper){if(this.css("left"),this.css("top"),this.width(),this.height(),e.parent=a,e.fparent=e.opts.turn?e.opts.turn.data().fparent:t("#turn-fwrappers"),!e.fparent){var i=t("<div/>",{css:{"pointer-events":"none"}}).hide();i.data().flips=0,e.opts.turn?(i.css(d(-e.opts.turn.offset().top,-e.opts.turn.offset().left,"auto","visible").css).appendTo(e.opts.turn),e.opts.turn.data().fparent=i):i.css(d(0,0,"auto","visible").css).attr("id","turn-fwrappers").appendTo(t("body")),e.fparent=i}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),e.wrapper=t("<div/>",d(0,0,this.css("z-index"))).appendTo(a).prepend(this),e.fwrapper=t("<div/>",d(a.offset().top,a.offset().left)).hide().appendTo(e.fparent),e.fpage=t("<div/>",{css:{cursor:"default"}}).appendTo(t("<div/>",d(0,0,0,"visible")).appendTo(e.fwrapper)),e.opts.frontGradient&&(e.ashadow=t("<div/>",d(0,0,1)).appendTo(e.fpage)),x.setData.call(this,e),x.resize.call(this,!0)}},_fold:function(t){var e,a,s,n,o,p,l=this,g=0,h=0,d=c(0,0),f=c(0,0),v=c(0,0),_=this.width(),w=this.height(),m=x._foldingPage.call(this),y=this.data().f,P=y.opts.acceleration,O=y.wrapper.height(),j=x._c.call(this,t.corner),M="t"==t.corner.substr(0,1),W="l"==t.corner.substr(1,1),z=function(){var u,$,b=c(j.x?j.x-t.x:t.x,j.y?j.y-t.y:t.y),m=Math.atan2(b.y,b.x);g=($=h=r-m)/i*180,u=c(W?_-b.x/2:t.x+b.x/2,b.y/2);var P=Math.max(0,Math.sin(h-Math.atan2(u.y,u.x))*Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2)));if(v=c(P*Math.sin(h),P*Math.cos(h)),h>r&&(v.x=v.x+Math.abs(v.y*Math.tan(m)),v.y=0,Math.round(v.x*Math.tan(i-h))<w))return t.y=Math.sqrt(Math.pow(w,2)+2*u.x*b.x),M&&(t.y=w-t.y),z();if(h>r){var k=i-h,F=O-w/Math.sin(k);d=c(Math.round(F*Math.cos(k)),Math.round(F*Math.sin(k))),W&&(d.x=-d.x),M&&(d.y=-d.y)}var D=_-(e=Math.round(v.y/Math.tan(h)+v.x)),A=D*Math.cos(2*h),T=D*Math.sin(2*h);f=c(Math.round(W?D-A:e+A),Math.round(M?T:w-T)),o=D*Math.sin(h);var G=x._c2.call(l,t.corner),E=Math.sqrt(Math.pow(G.x-t.x,2)+Math.pow(G.y-t.y,2));return p=E<_?E/_:1,y.opts.frontGradient&&(n=o>100?(o-100)/o:0,a=c(o*Math.sin(r-h)/w*100,o*Math.cos(r-h)/_*100),M&&(a.y=100-a.y),W&&(a.x=100-a.x)),x._backGradient.call(l)&&(s=c(o*Math.sin(h)/_*100,o*Math.cos(h)/w*100),W||(s.x=100-s.x),M||(s.y=100-s.y)),v.x=Math.round(v.x),v.y=Math.round(v.y),!0},k=function(t,e,i,r){var o=["0","auto"],g=(_-O)*i[0]/100,v=(w-O)*i[1]/100,m={left:o[e[0]],top:o[e[1]],right:o[e[2]],bottom:o[e[3]]},j=90!=r&&-90!=r?W?-1:1:0;i=i[0]+"% "+i[1]+"%",l.css(m).transform($(r)+u(t.x+j,t.y,P),i),y.fpage.parent().css(m),y.wrapper.transform(u(-t.x+g-j,-t.y+v,P)+$(-r),i),y.fwrapper.transform(u(-t.x+d.x+g,-t.y+d.y+v,P)+$(-r),i),y.fpage.parent().transform($(r)+u(t.x+f.x-d.x,t.y+f.y-d.y,P),i),y.opts.frontGradient&&b(y.ashadow,c(W?100:0,M?100:0),c(a.x,a.y),[[n,"rgba(0,0,0,0)"],[(1-n)*.8+n,"rgba(0,0,0,"+.2*p+")",],[1,"rgba(255,255,255,"+.2*p+")"],],3,h),x._backGradient.call(l)&&b(y.bshadow,c(W?0:100,M?0:100),c(s.x,s.y),[[.8,"rgba(0,0,0,0)"],[1,"rgba(0,0,0,"+.3*p+")"],[1,"rgba(0,0,0,0)"],],3)};switch(t.corner){case"tl":t.x=Math.max(t.x,1),z(),k(v,[1,0,0,1],[100,0],g),y.fpage.transform(u(-w,-_,P)+$(90-2*g),"100% 100%"),m.transform($(90)+u(0,-w,P),"0% 0%");break;case"tr":t.x=Math.min(t.x,_-1),z(),k(c(-v.x,v.y),[0,0,0,1],[0,0],-g),y.fpage.transform(u(0,-_,P)+$(-90+2*g),"0% 100%"),m.transform($(270)+u(-_,0,P),"0% 0%");break;case"bl":t.x=Math.max(t.x,1),z(),k(c(v.x,-v.y),[1,1,0,0],[100,100],-g),y.fpage.transform(u(-w,0,P)+$(-90+2*g),"100% 0%"),m.transform($(270)+u(-_,0,P),"0% 0%");break;case"br":t.x=Math.min(t.x,_-1),z(),k(c(-v.x,-v.y),[0,1,1,0],[0,100],g),y.fpage.transform($(90-2*g),"0% 0%"),m.transform($(90)+u(0,-w,P),"0% 0%")}y.point=t},_moveFoldingPage:function(t){var e=this.data().f,a=x._foldingPage.call(this);a&&(t?e.fpage.children()[e.ashadow?"1":"0"]||(x.setData.call(this,{backParent:a.parent()}),e.fpage.prepend(a)):e.backParent&&e.backParent.prepend(a))},_showFoldedPage:function(e,a){var i=x._foldingPage.call(this),r=this.data(),s=r.f;if(!s.point||s.point.corner!=e.corner){var n=t.Event("start");if(this.trigger(n,[s.opts,e.corner]),n.isDefaultPrevented())return!1}if(i){if(a){var o=this,p=s.point&&s.point.corner==e.corner?s.point:x._c.call(this,e.corner,1);this.animatef({from:[p.x,p.y],to:[e.x,e.y],duration:500,frame:function(t){e.x=Math.round(t[0]),e.y=Math.round(t[1]),x._fold.call(o,e)}})}else x._fold.call(this,e),r.effect&&!r.effect.turning&&this.animatef(!1);return!s.fwrapper.is(":visible")&&(s.fparent.show().data().flips++,x._moveFoldingPage.call(this,!0),s.fwrapper.show(),s.bshadow&&s.bshadow.show()),!0}return!1},hide:function(){var t=this.data().f,e=x._foldingPage.call(this);return 0==--t.fparent.data().flips&&t.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("","0% 100%"),t.wrapper.transform("","0% 100%"),t.fwrapper.hide(),t.bshadow&&t.bshadow.hide(),e.transform("","0% 0%"),this},hideFoldedPage:function(t){var e=this.data().f;if(e.point){var a=this,i=e.point,r=function(){e.point=null,a.flip("hide"),a.trigger("end",[!1])};if(t){var s=x._c.call(this,i.corner),n="t"==i.corner.substr(0,1)?Math.min(0,i.y-s.y)/2:Math.max(0,i.y-s.y)/2,o=c(i.x,i.y+n),p=c(s.x,s.y-n);this.animatef({from:0,to:1,frame:function(t){var e=f(i,o,p,s,t);i.x=e.x,i.y=e.y,x._fold.call(a,i)},complete:r,duration:800,hiding:!0})}else this.animatef(!1),r()}},turnPage:function(t){var e=this,a=this.data().f;t={corner:a.corner?a.corner.corner:t||x._cAllowed.call(this)[0]};var i=a.point||x._c.call(this,t.corner,a.opts.turn?a.opts.turn.data().opts.elevation:0),r=x._c2.call(this,t.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(a){var s=f(i,i,r,r,a);t.x=s.x,t.y=s.y,x._showFoldedPage.call(e,t)},complete:function(){e.trigger("end",[!0])},duration:a.opts.duration,turning:!0}),a.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},_eventStart:function(t){var e=this.data().f;if(!e.disabled&&!this.flip("isTurning")){if(e.corner=x._cornerActivated.call(this,t),e.corner&&x._foldingPage.call(this,e.corner))return x._moveFoldingPage.call(this,!0),this.trigger("pressed",[e.point]),!1;e.corner=null}},_eventMove:function(t){var e=this.data().f;if(!e.disabled){if(t=s?t.originalEvent.touches:[t],e.corner){var a=e.parent.offset();e.corner.x=t[0].pageX-a.left,e.corner.y=t[0].pageY-a.top,x._showFoldedPage.call(this,e.corner)}else if(!this.data().effect&&this.is(":visible")){var i=x._cornerActivated.call(this,t[0]);if(i){var r=x._c.call(this,i.corner,e.opts.cornerSize/2);i.x=r.x,i.y=r.y,x._showFoldedPage.call(this,i,!0)}else x.hideFoldedPage.call(this,!0)}}},_eventEnd:function(){var e=this.data().f;if(!e.disabled&&e.point){var a=t.Event("released");this.trigger(a,[e.point]),a.isDefaultPrevented()||x.hideFoldedPage.call(this,!0)}e.corner=null},disable:function(t){return x.setData.call(this,{disabled:t}),this}},m=function(t,e,a){if(!a[0]||"object"==typeof a[0])return e.init.apply(t,a);if(e[a[0]]&&"_"!=a[0].toString().substr(0,1))return e[a[0]].apply(t,Array.prototype.slice.call(a,1));throw a[0]+" is an invalid value"};t.extend(t.fn,{flip:function(t,e){return m(this,x,arguments)},turn:function(t){return m(this,w,arguments)},transform:function(t,e){var i={};return e&&(i[a+"transform-origin"]=e),i[a+"transform"]=t,this.css(i)},animatef:function(t){var e=this.data();if(e.effect&&clearInterval(e.effect.handle),t){t.to.length||(t.to=[t.to]),t.from.length||(t.from=[t.from]),t.easing||(t.easing=function(t,e,a,i,r){return i*Math.sqrt(1-(e=e/r-1)*e)+a});var a,i=[],r=t.to.length,s=this,n=t.fps||30,o=-n,p=function(){var a,p=[];for(a=0,o=Math.min(t.duration,o+n);a<r;a++)p.push(t.easing(1,o,t.from[a],i[a],t.duration));t.frame(1==r?p[0]:p),o==t.duration&&(clearInterval(e.effect.handle),delete e.effect,s.data(e),t.complete&&t.complete())};for(a=0;a<r;a++)i.push(t.to[a]-t.from[a]);e.effect=t,e.effect.handle=setInterval(p,n),this.data(e),p()}else delete e.effect}}),t.isTouch=s}(jQuery);